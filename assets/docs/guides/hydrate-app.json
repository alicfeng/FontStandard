{"title":"Hydrate App - Stencil","description":"Hydrate App","url":"/docs/hydrate-app","contributors":["adamdbradley","dgautsch","bitflower"],"lastUpdated":"2020-05-11T16:09:13Z","headings":[{"id":"hydrate-app","level":1,"text":"Hydrate App"},{"id":"how-to-use-the-hydrate-app","level":2,"text":"How to Use the Hydrate App"},{"id":"hydratedocument-options","level":4,"text":"hydrateDocument Options"},{"id":"rendertostring-options","level":4,"text":"renderToString Options"}],"srcPath":"./src/docs/guides/hydrate-app.md","hypertext":["div",null,["h1",{"id":"hydrate-app"},"\n  \n  Hydrate App\n  \n"],"\n",["p",null,"The hydrate app is a bundle of your same components, but compiled so they can be hydrated on a NodeJS server, and generate HTML. This is the same NodeJS app which prerendering uses internally, and the same one which Angular Universal SSR uses for Ionic. Like Stencil components, the hydrate app itself is not restricted to one framework."],"\n",["p",null,["em",null,"Note that Stencil does ",["strong",null,"NOT"]," use Puppeteer for SSR or prerendering."]],"\n\n",["h2",{"id":"how-to-use-the-hydrate-app"},"\n  ",["a",{"class":"heading-link","href":"#how-to-use-the-hydrate-app"},["app-icon",{"name":"link"}],"\n  How to Use the Hydrate App\n  "],"\n"],"\n",["p",null,"Server side rendering (SSR) can be accomplished in a similar way to prerendering. Instead of using the ",["code",null,"--prerender"]," CLI flag, you can add ",["code",null,"{ type: 'dist-hydrate-script' }"]," to your ",["code",null,"stencil.config.js"],". This will generate a ",["code",null,"hydrate"]," app in your root project directory that can be imported and used by your Node server."],"\n",["p",null,"After publishing your component library, you can import the hydrate app into your server's code like this:"],"\n\n  ",["highlight-code",null,"\n    ",["pre",{"class":"language-javascript"},["code",{"class":"language-javascript"},["span",{"class":"token keyword"},"import"]," ",["span",{"class":"token punctuation"},"{"]," hydrateDocument ",["span",{"class":"token punctuation"},"}"]," ",["span",{"class":"token keyword"},"from"]," ",["span",{"class":"token string"},"'yourpackage/hydrate'"],["span",{"class":"token punctuation"},";"]]],"\n  "],"\n  ",["p",null,"The app comes with two functions, ",["code",null,"hydrateDocument"]," and ",["code",null,"renderToString"],". An advantage to ",["code",null,"hydrateDocument"]," is that it can take an existing ",["a",{"href":"https://developer.mozilla.org/en-US/docs/Web/API/HTMLDocument"},"document"]," which was already parsed. The ",["code",null,"renderToString"]," function instead inputs a raw html string, and does the parsing to a document."],"\n",["p",null,["strong",null,"hydrateDocument"],": You can use ",["code",null,"hydrateDocument"]," as a part of your server's response logic before serving the web page. ",["code",null,"hydrateDocument"]," takes two arguments, a ",["a",{"href":"https://developer.mozilla.org/en-US/docs/Web/API/HTMLDocument"},"document"]," and a config object. The function returns a promise with the hydrated results. The resulting html can be parsed from the ",["code",null,"html"]," property in the returned results."],"\n",["p",null,["em",null,"Example taken from Ionic Angular server"]],"\n\n  ",["highlight-code",null,"\n    ",["pre",{"class":"language-javascript"},["code",{"class":"language-javascript"},["span",{"class":"token keyword"},"import"]," ",["span",{"class":"token punctuation"},"{"]," hydrateDocument ",["span",{"class":"token punctuation"},"}"]," ",["span",{"class":"token keyword"},"from"]," ",["span",{"class":"token string"},"'yourpackage/hydrate'"],["span",{"class":"token punctuation"},";"],"\n\n",["span",{"class":"token keyword"},"export"]," ",["span",{"class":"token keyword"},"function"]," ",["span",{"class":"token function"},"hydrateComponents"],["span",{"class":"token punctuation"},"("],["span",{"class":"token parameter"},"doc"],["span",{"class":"token punctuation"},")"]," ",["span",{"class":"token punctuation"},"{"],"\n  ",["span",{"class":"token keyword"},"return"]," ",["span",{"class":"token function"},"hydrateDocument"],["span",{"class":"token punctuation"},"("],"doc",["span",{"class":"token punctuation"},")"],"\n    ",["span",{"class":"token punctuation"},"."],["span",{"class":"token function"},"then"],["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},"("],["span",{"class":"token parameter"},"hydrateResults"],["span",{"class":"token punctuation"},")"]," ",["span",{"class":"token operator"},"=>"]," ",["span",{"class":"token punctuation"},"{"],"\n      ",["span",{"class":"token comment"},"// execute logic based on results"],"\n      console",["span",{"class":"token punctuation"},"."],["span",{"class":"token function"},"log"],["span",{"class":"token punctuation"},"("],"hydrateResults",["span",{"class":"token punctuation"},"."],"html",["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"],"\n      ",["span",{"class":"token keyword"},"return"]," hydrateResults",["span",{"class":"token punctuation"},";"],"\n    ",["span",{"class":"token punctuation"},"}"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"],"\n",["span",{"class":"token punctuation"},"}"]]],"\n  "],"\n  \n",["h4",{"id":"hydratedocument-options"},"\n  ",["a",{"class":"heading-link","href":"#hydratedocument-options"},["app-icon",{"name":"link"}],"\n  hydrateDocument Options\n  "],"\n"],"\n",["ul",null,"\n",["li",null,["code",null,"canonicalUrl"]," - string"],"\n",["li",null,["code",null,"constrainTimeouts"]," - boolean"],"\n",["li",null,["code",null,"clientHydrateAnnotations"]," - boolean"],"\n",["li",null,["code",null,"cookie"]," - string"],"\n",["li",null,["code",null,"direction"]," - string"],"\n",["li",null,["code",null,"language"]," - string"],"\n",["li",null,["code",null,"maxHydrateCount"]," - number"],"\n",["li",null,["code",null,"referrer"]," - string"],"\n",["li",null,["code",null,"removeScripts"]," - boolean"],"\n",["li",null,["code",null,"removeUnusedStyles"]," - boolean"],"\n",["li",null,["code",null,"resourcesUrl"]," - string"],"\n",["li",null,["code",null,"timeout"]," - number"],"\n",["li",null,["code",null,"title"]," - string"],"\n",["li",null,["code",null,"url"]," - string"],"\n",["li",null,["code",null,"userAgent"]," - string"],"\n"],"\n",["p",null,["strong",null,"renderToString"],": The hydrate app also has a ",["code",null,"renderToString"]," function that allows you to pass in an html string that also returns a promise of ",["code",null,"HydrateResults"],". The second parameter is a config object that can alter the output of the markup. Like ",["code",null,"hydrateDocument"],", the resulting string can be parsed from the ",["code",null,"html"]," property."],"\n",["p",null,["em",null,"Example taken from Ionic Core"]],"\n\n  ",["highlight-code",null,"\n    ",["pre",{"class":"language-javascript"},["code",{"class":"language-javascript"},["span",{"class":"token keyword"},"const"]," results ",["span",{"class":"token operator"},"="]," ",["span",{"class":"token keyword"},"await"]," hydrate",["span",{"class":"token punctuation"},"."],["span",{"class":"token function"},"renderToString"],["span",{"class":"token punctuation"},"("],"srcHtml",["span",{"class":"token punctuation"},","]," ",["span",{"class":"token punctuation"},"{"],"\n  prettyHtml",["span",{"class":"token operator"},":"]," ",["span",{"class":"token boolean"},"true"],["span",{"class":"token punctuation"},","],"\n  removeScripts",["span",{"class":"token operator"},":"]," ",["span",{"class":"token boolean"},"true"],"\n",["span",{"class":"token punctuation"},"}"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"],"\n\nconsole",["span",{"class":"token punctuation"},"."],["span",{"class":"token function"},"log"],["span",{"class":"token punctuation"},"("],"results",["span",{"class":"token punctuation"},"."],"html",["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"]]],"\n  "],"\n  \n",["h4",{"id":"rendertostring-options"},"\n  ",["a",{"class":"heading-link","href":"#rendertostring-options"},["app-icon",{"name":"link"}],"\n  renderToString Options\n  "],"\n"],"\n",["ul",null,"\n",["li",null,["code",null,"approximateLineWidth"]," - number"],"\n",["li",null,["code",null,"prettyHtml"]," - boolean"],"\n",["li",null,["code",null,"removeAttributeQuotes"]," - boolean"],"\n",["li",null,["code",null,"removeBooleanAttributeQuotes"]," - boolean"],"\n",["li",null,["code",null,"removeEmptyAttributes"]," - boolean"],"\n",["li",null,["code",null,"removeHtmlComments"]," - boolean"],"\n",["li",null,["code",null,"afterHydrate"]," - boolean"],"\n",["li",null,["code",null,"beforeHydrate"]," - boolean"],"\n"]]}