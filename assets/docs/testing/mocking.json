{"title":"Mocking - Stencil","description":"Mocking","url":"/docs/mocking","contributors":["simonhaenisch","zooduck","adamdbradley"],"lastUpdated":"2019-06-12T00:16:19Z","headings":[{"id":"mocking","level":1,"text":"Mocking"},{"id":"mocking-a-library","level":2,"text":"Mocking a Library"},{"id":"mocking-your-own-code","level":2,"text":"Mocking Your Own Code"},{"id":"mocking-in-e2e-tests","level":2,"text":"Mocking in E2E Tests"}],"srcPath":"./src/docs/testing/mocking.md","hypertext":["div",null,["h1",{"id":"mocking"},"\n  \n  Mocking\n  \n"],"\n",["p",null,"Since Stencil's testing capabilities are built on top of Jest, the mocking features of Jest can be utilized to mock out libraries or certain parts of your code. For further information have a look at the ",["a",{"href":"https://jestjs.io/docs/en/manual-mocks"},"Jest docs"],"."],"\n\n",["h2",{"id":"mocking-a-library"},"\n  ",["a",{"class":"heading-link","href":"#mocking-a-library"},["app-icon",{"name":"link"}],"\n  Mocking a Library\n  "],"\n"],"\n",["p",null,"To create a mock for a library that is imported from ",["code",null,"node_modules"],", you can simply create a folder ",["code",null,"__mocks__"]," on the same directory level as ",["code",null,"node_modules"]," (usually in your project's root folder), then create a file in there with the same name as the package you want to mock, and that mock will automatically be applied."],"\n",["p",null,"For example, if you want to mock ",["code",null,"md5"],", you'd create a file ",["code",null,"__mocks__/md5.ts"]," with the following content:"],"\n\n  ",["highlight-code",null,"\n    ",["pre",{"class":"language-ts"},["code",{"class":"language-ts"},"export default () => 'fakehash';"]],"\n  "],"\n  ",["blockquote",null,"\n",["p",null,"If you want to mock a scoped package like ",["code",null,"@capacitor/core"],", you'll have to create the file as ",["code",null,"__mocks__/@capacitor/core.ts"],"."],"\n"],"\n\n",["h2",{"id":"mocking-your-own-code"},"\n  ",["a",{"class":"heading-link","href":"#mocking-your-own-code"},["app-icon",{"name":"link"}],"\n  Mocking Your Own Code\n  "],"\n"],"\n",["p",null,"To create a mock for some of your own code, you'll have to create the mocks folder on a different layer."],"\n",["p",null,"Let's say you have a file ",["code",null,"src/helpers/utils.ts"]," that exposes a ",["code",null,"getRandomInt"]," helper, and a service that provides a function which uses this helper."],"\n\n  ",["highlight-code",null,"\n    ",["pre",{"class":"language-tsx"},["code",{"class":"language-tsx"},["span",{"class":"token comment"},"// src/helpers/utils.ts"],"\n\n",["span",{"class":"token keyword"},"export"]," ",["span",{"class":"token keyword"},"const"]," ",["span",{"class":"token function-variable function"},"getRandomInt"]," ",["span",{"class":"token operator"},"="]," ",["span",{"class":"token punctuation"},"("],["span",{"class":"token parameter"},"min",["span",{"class":"token operator"},":"]," number",["span",{"class":"token punctuation"},","]," max",["span",{"class":"token operator"},":"]," number"],["span",{"class":"token punctuation"},")"]," ",["span",{"class":"token operator"},"=>"],"\n  Math",["span",{"class":"token punctuation"},"."],["span",{"class":"token function"},"round"],["span",{"class":"token punctuation"},"("],"Math",["span",{"class":"token punctuation"},"."],["span",{"class":"token function"},"random"],["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},")"]," ",["span",{"class":"token operator"},"*"]," ",["span",{"class":"token punctuation"},"("],"max ",["span",{"class":"token operator"},"-"]," min",["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},")"]," ",["span",{"class":"token operator"},"+"]," min",["span",{"class":"token punctuation"},";"]]],"\n  "],"\n  \n  ",["highlight-code",null,"\n    ",["pre",{"class":"language-tsx"},["code",{"class":"language-tsx"},["span",{"class":"token comment"},"// src/services/foo.ts"],"\n\n",["span",{"class":"token keyword"},"import"]," ",["span",{"class":"token punctuation"},"{"]," getRandomInt ",["span",{"class":"token punctuation"},"}"]," ",["span",{"class":"token keyword"},"from"]," ",["span",{"class":"token string"},"'../helpers/utils'"],["span",{"class":"token punctuation"},";"],"\n\n",["span",{"class":"token keyword"},"export"]," ",["span",{"class":"token keyword"},"const"]," ",["span",{"class":"token function-variable function"},"bar"]," ",["span",{"class":"token operator"},"="]," ",["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},")"]," ",["span",{"class":"token operator"},"=>"]," ",["span",{"class":"token function"},"getRandomInt"],["span",{"class":"token punctuation"},"("],["span",{"class":"token number"},"0"],["span",{"class":"token punctuation"},","]," ",["span",{"class":"token number"},"10"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"]]],"\n  "],"\n  ",["p",null,"To mock this function, you create a file ",["code",null,"src/helpers/__mocks__/utils.ts"]," and write your mock in that file."],"\n\n  ",["highlight-code",null,"\n    ",["pre",{"class":"language-tsx"},["code",{"class":"language-tsx"},["span",{"class":"token comment"},"// src/helpers/__mocks__/utils.ts"],"\n\n",["span",{"class":"token keyword"},"export"]," ",["span",{"class":"token keyword"},"const"]," ",["span",{"class":"token function-variable function"},"getRandomInt"]," ",["span",{"class":"token operator"},"="]," ",["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},")"]," ",["span",{"class":"token operator"},"=>"]," ",["span",{"class":"token number"},"42"],["span",{"class":"token punctuation"},";"]]],"\n  "],"\n  ",["p",null,"Because Jest only auto-mocks node modules, you'll also have to let your test know that you want it to apply that mock, by calling ",["code",null,"jest.mock()"],"."],"\n\n  ",["highlight-code",null,"\n    ",["pre",{"class":"language-tsx"},["code",{"class":"language-tsx"},["span",{"class":"token comment"},"// src/foo.spec.ts"],"\n\njest",["span",{"class":"token punctuation"},"."],["span",{"class":"token function"},"mock"],["span",{"class":"token punctuation"},"("],["span",{"class":"token string"},"'./helpers/utils'"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"],"\n\n",["span",{"class":"token keyword"},"import"]," ",["span",{"class":"token punctuation"},"{"]," bar ",["span",{"class":"token punctuation"},"}"]," ",["span",{"class":"token keyword"},"from"]," ",["span",{"class":"token string"},"'./services/foo'"],["span",{"class":"token punctuation"},";"],"\n\n",["span",{"class":"token function"},"describe"],["span",{"class":"token punctuation"},"("],["span",{"class":"token string"},"'Foo'"],["span",{"class":"token punctuation"},","]," ",["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},")"]," ",["span",{"class":"token operator"},"=>"]," ",["span",{"class":"token punctuation"},"{"],"\n  ",["span",{"class":"token function"},"it"],["span",{"class":"token punctuation"},"("],["span",{"class":"token string"},"'bar()'"],["span",{"class":"token punctuation"},","]," ",["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},")"]," ",["span",{"class":"token operator"},"=>"]," ",["span",{"class":"token punctuation"},"{"],"\n    ",["span",{"class":"token function"},"expect"],["span",{"class":"token punctuation"},"("],["span",{"class":"token function"},"bar"],["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},"."],["span",{"class":"token function"},"toBe"],["span",{"class":"token punctuation"},"("],["span",{"class":"token number"},"42"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"],"\n  ",["span",{"class":"token punctuation"},"}"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"],"\n",["span",{"class":"token punctuation"},"}"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"]]],"\n  "],"\n  ",["blockquote",null,"\n",["p",null,"It's important that you call ",["code",null,"jest.mock('...')"]," before your import."],"\n"],"\n",["p",null,"Instead of creating a file in a ",["code",null,"__mocks__"]," folder, there is an alternative approach of providing a mock: the ",["code",null,"jest.mock()"]," function takes a module factory function as an optional second argument. The following test will work the same as the one before, without having to create a ",["code",null,"src/helpers/__mocks__/utils.ts"]," file."],"\n\n  ",["highlight-code",null,"\n    ",["pre",{"class":"language-tsx"},["code",{"class":"language-tsx"},["span",{"class":"token comment"},"// src/foo.spec.ts"],"\n\njest",["span",{"class":"token punctuation"},"."],["span",{"class":"token function"},"mock"],["span",{"class":"token punctuation"},"("],["span",{"class":"token string"},"'./helpers/utils'"],["span",{"class":"token punctuation"},","]," ",["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},")"]," ",["span",{"class":"token operator"},"=>"]," ",["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},"{"],"\n    ",["span",{"class":"token function-variable function"},"getRandomInt"],["span",{"class":"token operator"},":"]," ",["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},")"]," ",["span",{"class":"token operator"},"=>"]," ",["span",{"class":"token number"},"42"],["span",{"class":"token punctuation"},","],"\n",["span",{"class":"token punctuation"},"}"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"],"\n\n",["span",{"class":"token keyword"},"import"]," ",["span",{"class":"token punctuation"},"{"]," foo ",["span",{"class":"token punctuation"},"}"]," ",["span",{"class":"token keyword"},"from"]," ",["span",{"class":"token string"},"'./services/foo'"],["span",{"class":"token punctuation"},";"],"\n\n",["span",{"class":"token function"},"describe"],["span",{"class":"token punctuation"},"("],["span",{"class":"token string"},"'Foo'"],["span",{"class":"token punctuation"},","]," ",["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},")"]," ",["span",{"class":"token operator"},"=>"]," ",["span",{"class":"token punctuation"},"{"],"\n  ",["span",{"class":"token function"},"it"],["span",{"class":"token punctuation"},"("],["span",{"class":"token string"},"'bar()'"],["span",{"class":"token punctuation"},","]," ",["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},")"]," ",["span",{"class":"token operator"},"=>"]," ",["span",{"class":"token punctuation"},"{"],"\n    ",["span",{"class":"token function"},"expect"],["span",{"class":"token punctuation"},"("],["span",{"class":"token function"},"bar"],["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},"."],["span",{"class":"token function"},"toBe"],["span",{"class":"token punctuation"},"("],["span",{"class":"token number"},"42"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"],"\n  ",["span",{"class":"token punctuation"},"}"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"],"\n",["span",{"class":"token punctuation"},"}"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"]]],"\n  "],"\n  \n",["h2",{"id":"mocking-in-e2e-tests"},"\n  ",["a",{"class":"heading-link","href":"#mocking-in-e2e-tests"},["app-icon",{"name":"link"}],"\n  Mocking in E2E Tests\n  "],"\n"],"\n",["p",null,"If you use ",["code",null,"newE2EPage"]," in an end-to-end test, your component's code will be executed in a browser context (Stencil will launch a headless Chromium instance using Puppeteer). However your mocks will only be registered in the Node.js context, which means that your component will still call the original implementation. If you need to mock something in the browser context, you can either have a look at ",["a",{"href":"https://jestjs.io/docs/en/puppeteer"},"using Jest with Puppeteer"],", or possibly switch to using ",["code",null,"newSpecPage"],", which creates a virtual (mocked) DOM in the node context."],"\n\n  ",["highlight-code",null,"\n    ",["pre",{"class":"language-tsx"},["code",{"class":"language-tsx"},["span",{"class":"token comment"},"// src/components/foo/foo.tsx"],"\n\n",["span",{"class":"token keyword"},"import"]," ",["span",{"class":"token punctuation"},"{"]," h",["span",{"class":"token punctuation"},","]," Component",["span",{"class":"token punctuation"},","]," Method ",["span",{"class":"token punctuation"},"}"]," ",["span",{"class":"token keyword"},"from"]," ",["span",{"class":"token string"},"'@stencil/core'"],["span",{"class":"token punctuation"},";"],"\n",["span",{"class":"token keyword"},"import"]," ",["span",{"class":"token punctuation"},"{"]," getRandomInt ",["span",{"class":"token punctuation"},"}"]," ",["span",{"class":"token keyword"},"from"]," ",["span",{"class":"token string"},"'../../helpers/utils'"],["span",{"class":"token punctuation"},";"],"\n\n@",["span",{"class":"token function"},"Component"],["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},"{"]," tag",["span",{"class":"token operator"},":"]," ",["span",{"class":"token string"},"'foo-component'"]," ",["span",{"class":"token punctuation"},"}"],["span",{"class":"token punctuation"},")"],"\n",["span",{"class":"token keyword"},"export"]," ",["span",{"class":"token keyword"},"class"]," ",["span",{"class":"token class-name"},"Foo"]," ",["span",{"class":"token punctuation"},"{"],"\n    @",["span",{"class":"token function"},"Method"],["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},")"],"\n    ",["span",{"class":"token keyword"},"async"]," ",["span",{"class":"token function"},"bar"],["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},")"]," ",["span",{"class":"token punctuation"},"{"],"\n        ",["span",{"class":"token keyword"},"return"]," ",["span",{"class":"token function"},"getRandomInt"],["span",{"class":"token punctuation"},"("],["span",{"class":"token number"},"0"],["span",{"class":"token punctuation"},","]," ",["span",{"class":"token number"},"10"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"],"\n    ",["span",{"class":"token punctuation"},"}"],"\n\n    ",["span",{"class":"token function"},"render"],["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},")"]," ",["span",{"class":"token punctuation"},"{"],"\n        ",["span",{"class":"token keyword"},"return"]," ",["span",{"class":"token tag"},["span",{"class":"token tag"},["span",{"class":"token punctuation"},"<"],"div"]," ",["span",{"class":"token punctuation"},"/>"]],["span",{"class":"token punctuation"},";"],"\n    ",["span",{"class":"token punctuation"},"}"],"\n",["span",{"class":"token punctuation"},"}"]]],"\n  "],"\n  \n  ",["highlight-code",null,"\n    ",["pre",{"class":"language-tsx"},["code",{"class":"language-tsx"},["span",{"class":"token comment"},"// src/foo.e2e.ts"],"\n\njest",["span",{"class":"token punctuation"},"."],["span",{"class":"token function"},"mock"],["span",{"class":"token punctuation"},"("],["span",{"class":"token string"},"'./helpers/utils'"],["span",{"class":"token punctuation"},","]," ",["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},")"]," ",["span",{"class":"token operator"},"=>"]," ",["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},"{"],"\n    ",["span",{"class":"token function-variable function"},"getRandomInt"],["span",{"class":"token operator"},":"]," ",["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},")"]," ",["span",{"class":"token operator"},"=>"]," ",["span",{"class":"token number"},"42"],["span",{"class":"token punctuation"},","],"\n",["span",{"class":"token punctuation"},"}"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"],"\n\n",["span",{"class":"token keyword"},"import"]," ",["span",{"class":"token punctuation"},"{"]," newSpecPage ",["span",{"class":"token punctuation"},"}"]," ",["span",{"class":"token keyword"},"from"]," ",["span",{"class":"token string"},"'@stencil/core/testing'"],["span",{"class":"token punctuation"},";"],"\n",["span",{"class":"token keyword"},"import"]," ",["span",{"class":"token punctuation"},"{"]," Foo ",["span",{"class":"token punctuation"},"}"]," ",["span",{"class":"token keyword"},"from"]," ",["span",{"class":"token string"},"'./components/foo/foo'"],["span",{"class":"token punctuation"},";"],"\n\n",["span",{"class":"token function"},"describe"],["span",{"class":"token punctuation"},"("],["span",{"class":"token string"},"'Foo'"],["span",{"class":"token punctuation"},","]," ",["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},")"]," ",["span",{"class":"token operator"},"=>"]," ",["span",{"class":"token punctuation"},"{"],"\n    ",["span",{"class":"token function"},"it"],["span",{"class":"token punctuation"},"("],["span",{"class":"token string"},"'bar()'"],["span",{"class":"token punctuation"},","]," ",["span",{"class":"token keyword"},"async"]," ",["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},")"]," ",["span",{"class":"token operator"},"=>"]," ",["span",{"class":"token punctuation"},"{"],"\n        ",["span",{"class":"token keyword"},"const"]," page ",["span",{"class":"token operator"},"="]," ",["span",{"class":"token keyword"},"await"]," ",["span",{"class":"token function"},"newSpecPage"],["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},"{"],"\n            components",["span",{"class":"token operator"},":"]," ",["span",{"class":"token punctuation"},"["],"Foo",["span",{"class":"token punctuation"},"]"],["span",{"class":"token punctuation"},","],"\n            html",["span",{"class":"token operator"},":"]," ",["span",{"class":"token string"},"'<foo-component></foo-component>'"],["span",{"class":"token punctuation"},","],"\n        ",["span",{"class":"token punctuation"},"}"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"],"\n        ",["span",{"class":"token keyword"},"const"]," foo ",["span",{"class":"token operator"},"="]," page",["span",{"class":"token punctuation"},"."],"body",["span",{"class":"token punctuation"},"."],["span",{"class":"token function"},"querySelector"],["span",{"class":"token punctuation"},"("],["span",{"class":"token string"},"'foo-component'"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"],"\n\n        ",["span",{"class":"token keyword"},"if"]," ",["span",{"class":"token punctuation"},"("],["span",{"class":"token operator"},"!"],"foo",["span",{"class":"token punctuation"},")"]," ",["span",{"class":"token punctuation"},"{"],"\n            ",["span",{"class":"token keyword"},"throw"]," ",["span",{"class":"token keyword"},"new"]," ",["span",{"class":"token class-name"},"Error"],["span",{"class":"token punctuation"},"("],["span",{"class":"token string"},"'Could not find Foo component'"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"],"\n        ",["span",{"class":"token punctuation"},"}"],"\n\n        ",["span",{"class":"token function"},"expect"],["span",{"class":"token punctuation"},"("],["span",{"class":"token keyword"},"await"]," foo",["span",{"class":"token punctuation"},"."],["span",{"class":"token function"},"bar"],["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},"."],["span",{"class":"token function"},"toBe"],["span",{"class":"token punctuation"},"("],["span",{"class":"token number"},"42"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"],"\n    ",["span",{"class":"token punctuation"},"}"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"],"\n",["span",{"class":"token punctuation"},"}"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"]]],"\n  "]]}