{"title":"Bundling Custom Elements with Stencil - Stencil","description":"Bundling Custom Elements with Stencil","url":"/docs/custom-elements","contributors":["adamdbradley"],"headings":[{"id":"custom-elements-bundle","level":1,"text":"Custom Elements Bundle"},{"id":"defining-exported-custom-elements","level":2,"text":"Defining Exported Custom Elements"},{"id":"making-assets-available","level":2,"text":"Making Assets Available"},{"id":"distributing-custom-elements","level":2,"text":"Distributing Custom Elements"},{"id":"example-bundler-configs","level":2,"text":"Example Bundler Configs"},{"id":"webpack-config-js","level":3,"text":"webpack.config.js"},{"id":"rollup-config-js","level":3,"text":"rollup.config.js"},{"id":"how-is-this-different-from-the-dist-output-target","level":2,"text":"How is this different from the &quot;dist&quot; output target?"},{"id":"browser-support","level":2,"text":"Browser Support"}],"srcPath":"./src/docs/output-targets/custom-elements.md","hypertext":["div",null,["h1",{"id":"custom-elements-bundle"},"\n  \n  Custom Elements Bundle\n  \n"],"\n",["p",null,"The ",["code",null,"dist-custom-elements-bundle"]," output target is used to generate custom elements as a single bundle. Even though the output ends up as a \"single\" bundle, it's generated to ensure components are tree-shakable. For example, if a component library has 100 components, but an external project only imported one component from the bundle, then only the code used by that one component would be pulled into the project. This is due to Stencil's use of ES Modules and the compiler generating friendly code for bundlers to parse and understand."],"\n\n  ",["highlight-code",null,"\n    ",["pre",{"class":"language-tsx"},["code",{"class":"language-tsx"},"outputTargets",["span",{"class":"token operator"},":"]," ",["span",{"class":"token punctuation"},"["],"\n  ",["span",{"class":"token punctuation"},"{"],"\n    ",["span",{"class":"token keyword"},"type"],["span",{"class":"token operator"},":"]," ",["span",{"class":"token string"},"'dist-custom-elements-bundle'"],["span",{"class":"token punctuation"},","],"\n  ",["span",{"class":"token punctuation"},"}"],["span",{"class":"token punctuation"},","],"\n",["span",{"class":"token punctuation"},"]"],["span",{"class":"token punctuation"},";"]]],"\n  "],"\n  \n",["h2",{"id":"defining-exported-custom-elements"},"\n  ",["a",{"class":"heading-link","href":"#defining-exported-custom-elements"},["app-icon",{"name":"link"}],"\n  Defining Exported Custom Elements\n  "],"\n"],"\n",["p",null,"By default, the custom elements bundle will be written to ",["code",null,"dist/custom-elements/index.js"],". This directory can be configured using the output target's ",["code",null,"dir"]," config. The generated ",["code",null,"index.js"]," file contains exports to each component class and will have their styles included within the bundle. However, this build does not automatically define the custom elements or apply any polyfills."],"\n",["p",null,"Below is an example of defining a custom element within the bundle:"],"\n\n  ",["highlight-code",null,"\n    ",["pre",{"class":"language-tsx"},["code",{"class":"language-tsx"},["span",{"class":"token keyword"},"import"]," ",["span",{"class":"token punctuation"},"{"]," HelloWorld ",["span",{"class":"token punctuation"},"}"]," ",["span",{"class":"token keyword"},"from"]," ",["span",{"class":"token string"},"'my-library/dist/custom-elements'"],["span",{"class":"token punctuation"},";"],"\n\ncustomElements",["span",{"class":"token punctuation"},"."],["span",{"class":"token function"},"define"],["span",{"class":"token punctuation"},"("],["span",{"class":"token string"},"'hello-world'"],["span",{"class":"token punctuation"},","]," HelloWorld",["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"]]],"\n  "],"\n  ",["p",null,"If a component is dependent on other components, you'll need to register each one manually. This can be tedious so, for convenience, the bundle also exports a ",["code",null,"defineCustomElements()"]," method."],"\n",["p",null,"When ",["code",null,"defineCustomElements()"]," is called, it will define every component in the bundle. However, it does not run automatically and it will not be called if it is not imported and executed. It can also result in a larger bundle size if there are unused components being imported."],"\n\n  ",["highlight-code",null,"\n    ",["pre",{"class":"language-tsx"},["code",{"class":"language-tsx"},["span",{"class":"token keyword"},"import"]," ",["span",{"class":"token punctuation"},"{"]," defineCustomElements ",["span",{"class":"token punctuation"},"}"]," ",["span",{"class":"token keyword"},"from"]," ",["span",{"class":"token string"},"'my-library/dist/custom-elements'"],["span",{"class":"token punctuation"},";"],"\n\n",["span",{"class":"token function"},"defineCustomElements"],["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"]]],"\n  "],"\n  ",["p",null,"The generated bundle will export each component class and will already have the styles bundled. However, it does not define the custom elements or apply any polyfills."],"\n\n",["h2",{"id":"making-assets-available"},"\n  ",["a",{"class":"heading-link","href":"#making-assets-available"},["app-icon",{"name":"link"}],"\n  Making Assets Available\n  "],"\n"],"\n",["p",null,"For performance reasons, the generated bundle does not include ",["a",{"href":"/docs/local-assets"},"local assets"]," built within the JavaScript output, \nbut instead it's recommended to keep static assets as external files. By keeping them external this ensures they can be requested on-demand, rather\nthan either welding their content into the JS file, or adding many URLs for the bundler to add to the output. \nOne method to ensure ",["a",{"href":"/docs/local-assets"},"local assets"]," are available to external builds and http servers is to set the asset path using ",["code",null,"setAssetPath()"],"."],"\n",["p",null,"The ",["code",null,"setAssetPath()"]," function is used to manually set the base path where static assets can be found. \nFor the lazy-loaded output target the asset path is automatically set and assets copied to the correct\nbuild directory. However, for custom elements builds, the ",["code",null,"setAssetPath(path)"]," should be\nused to customize the asset path depending on where they are found on the http server."],"\n",["p",null,"If the component's script is a ",["code",null,"type=\"module\""],", it's recommended to use ",["code",null,"import.meta.url"],", such\nas ",["code",null,"setAssetPath(import.meta.url)"],". Other options include ",["code",null,"setAssetPath(document.currentScript.src)"],", or using a bundler's replace plugin to\ndynamically set the path at build time, such as ",["code",null,"setAssetPath(process.env.ASSET_PATH)"],"."],"\n\n  ",["highlight-code",null,"\n    ",["pre",{"class":"language-tsx"},["code",{"class":"language-tsx"},["span",{"class":"token keyword"},"import"]," ",["span",{"class":"token punctuation"},"{"]," defineCustomElements",["span",{"class":"token punctuation"},","]," setAssetPath ",["span",{"class":"token punctuation"},"}"]," ",["span",{"class":"token keyword"},"from"]," ",["span",{"class":"token string"},"'my-library/dist/custom-elements'"],["span",{"class":"token punctuation"},";"],"\n\n",["span",{"class":"token function"},"setAssetPath"],["span",{"class":"token punctuation"},"("],"document",["span",{"class":"token punctuation"},"."],"currentScript",["span",{"class":"token punctuation"},"."],"src",["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"],"\n",["span",{"class":"token function"},"defineCustomElements"],["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"]]],"\n  "],"\n  ",["p",null,"Make sure to copy the assets over to a public directory in your app.  This configuration depends on how your script is bundled, or lack of\nbunding, and where your assets can be loaded from. How the files are copied to the production build directory depends on the bundler or tooling. \nThe configs below provide examples of how to do this automatically with popular bundlers."],"\n\n",["h2",{"id":"distributing-custom-elements"},"\n  ",["a",{"class":"heading-link","href":"#distributing-custom-elements"},["app-icon",{"name":"link"}],"\n  Distributing Custom Elements\n  "],"\n"],"\n",["p",null,"Your component library can be easily distributed on NPM, similar to how ",["a",{"href":"https://www.npmjs.com/package/@ionic/core"},["code",null,"@ionic/core"]]," does it. From there, consumers of your library can decide how to import your library into their project. For the ",["code",null,"dist-custom-elements-bundle"],", the default import location would be ",["code",null,"my-library/dist/custom-elements-bundle"],", but this can get further configured within the ",["code",null,"package.json"]," file."],"\n",["p",null,"To make the custom elements bundle the entry module for a package, set the ",["code",null,"module"]," property in ",["code",null,"package.json"]," to:"],"\n",["p",null,"Also be sure to set ",["code",null,"@stencil/core"]," as a dependency of the package."],"\n\n  ",["highlight-code",null,"\n    ",["pre",{"class":"language-tsx"},["code",{"class":"language-tsx"},["span",{"class":"token punctuation"},"{"],"\n  ",["span",{"class":"token string"},"\"module\""],["span",{"class":"token operator"},":"]," ",["span",{"class":"token string"},"\"dist/custom-elements-bundle/index.js\""],["span",{"class":"token punctuation"},","],"\n  ",["span",{"class":"token string"},"\"dependencies\""],["span",{"class":"token operator"},":"]," ",["span",{"class":"token punctuation"},"{"],"\n    ",["span",{"class":"token string"},"\"@stencil/core\""],["span",{"class":"token operator"},":"]," ",["span",{"class":"token string"},"\"latest\""],"\n  ",["span",{"class":"token punctuation"},"}"],["span",{"class":"token punctuation"},","],"\n  ",["span",{"class":"token operator"},"..."],"\n",["span",{"class":"token punctuation"},"}"]]],"\n  "],"\n  ",["p",null,"Note: If you are distributing both the ",["code",null,"dist"]," and ",["code",null,"dist-custom-elements-bundle"],", then it's up to you to choose which one of them should be available in the ",["code",null,"module"]," entry."],"\n",["p",null,"Now you can publish your library to ",["a",{"href":"https://www.npmjs.com/"},"Node Package Manager (NPM)"],". For more information about setting up the ",["code",null,"package.json"]," file, and publishing, see: ",["a",{"href":"/docs/publishing"},"Publishing Component Library To NPM"],"."],"\n\n",["h2",{"id":"example-bundler-configs"},"\n  ",["a",{"class":"heading-link","href":"#example-bundler-configs"},["app-icon",{"name":"link"}],"\n  Example Bundler Configs\n  "],"\n"],"\n",["p",null,"Instructions for consuming the custom elements bundle vary depending on the bundler you're using. These examples will help your users consume your components with webpack and Rollup."],"\n",["p",null,"The following examples assume your component library is published to NPM as ",["code",null,"my-library"],". You should change this to the name you actually publish your library with."],"\n",["p",null,"Users will need to install your library before importing them."],"\n\n  ",["highlight-code",null,"\n    ",["pre",{"class":"language-bash"},["code",{"class":"language-bash"},["span",{"class":"token function"},"npm"]," ",["span",{"class":"token function"},"install"]," my-library"]],"\n  "],"\n  \n",["h3",{"id":"webpack-config-js"},"\n  ",["a",{"class":"heading-link","href":"#webpack-config-js"},["app-icon",{"name":"link"}],"\n  webpack.config.js\n  "],"\n"],"\n",["p",null,"A webpack config will look something like the one below. Note how assets are copied from the library's ",["code",null,"node_module"]," folder to ",["code",null,"dist/assets"]," via the ",["code",null,"CopyPlugin"]," utility. This is important if your library includes ",["a",{"href":"/docs/local-assets"},"local assets"],"."],"\n\n  ",["highlight-code",null,"\n    ",["pre",{"class":"language-javascript"},["code",{"class":"language-javascript"},["span",{"class":"token keyword"},"const"]," path ",["span",{"class":"token operator"},"="]," ",["span",{"class":"token function"},"require"],["span",{"class":"token punctuation"},"("],["span",{"class":"token string"},"'path'"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"],"\n",["span",{"class":"token keyword"},"const"]," CopyPlugin ",["span",{"class":"token operator"},"="]," ",["span",{"class":"token function"},"require"],["span",{"class":"token punctuation"},"("],["span",{"class":"token string"},"'copy-webpack-plugin'"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"],"\n\nmodule",["span",{"class":"token punctuation"},"."],"exports ",["span",{"class":"token operator"},"="]," ",["span",{"class":"token punctuation"},"{"],"\n  entry",["span",{"class":"token operator"},":"]," ",["span",{"class":"token string"},"'./src/index.js'"],["span",{"class":"token punctuation"},","],"\n  output",["span",{"class":"token operator"},":"]," ",["span",{"class":"token punctuation"},"{"],"\n    filename",["span",{"class":"token operator"},":"]," ",["span",{"class":"token string"},"'main.js'"],["span",{"class":"token punctuation"},","],"\n    path",["span",{"class":"token operator"},":"]," path",["span",{"class":"token punctuation"},"."],["span",{"class":"token function"},"resolve"],["span",{"class":"token punctuation"},"("],"__dirname",["span",{"class":"token punctuation"},","]," ",["span",{"class":"token string"},"'dist'"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},","],"\n  ",["span",{"class":"token punctuation"},"}"],["span",{"class":"token punctuation"},","],"\n  module",["span",{"class":"token operator"},":"]," ",["span",{"class":"token punctuation"},"{"],"\n    rules",["span",{"class":"token operator"},":"]," ",["span",{"class":"token punctuation"},"["],"\n      ",["span",{"class":"token punctuation"},"{"],"\n        test",["span",{"class":"token operator"},":"]," ",["span",{"class":"token regex"},"/\\.css$/i"],["span",{"class":"token punctuation"},","],"\n        use",["span",{"class":"token operator"},":"]," ",["span",{"class":"token punctuation"},"["],["span",{"class":"token string"},"'style-loader'"],["span",{"class":"token punctuation"},","]," ",["span",{"class":"token string"},"'css-loader'"],["span",{"class":"token punctuation"},"]"],["span",{"class":"token punctuation"},","],"\n      ",["span",{"class":"token punctuation"},"}"],["span",{"class":"token punctuation"},","],"\n    ",["span",{"class":"token punctuation"},"]"],["span",{"class":"token punctuation"},","],"\n  ",["span",{"class":"token punctuation"},"}"],["span",{"class":"token punctuation"},","],"\n  plugins",["span",{"class":"token operator"},":"]," ",["span",{"class":"token punctuation"},"["],"\n    ",["span",{"class":"token keyword"},"new"]," ",["span",{"class":"token class-name"},"CopyPlugin"],["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},"{"],"\n      patterns",["span",{"class":"token operator"},":"]," ",["span",{"class":"token punctuation"},"["],"\n        ",["span",{"class":"token punctuation"},"{"],"\n          ",["span",{"class":"token keyword"},"from"],["span",{"class":"token operator"},":"]," path",["span",{"class":"token punctuation"},"."],["span",{"class":"token function"},"resolve"],["span",{"class":"token punctuation"},"("],"__dirname",["span",{"class":"token punctuation"},","]," ",["span",{"class":"token string"},"'node_modules/my-library/dist/my-library/assets'"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},","],"\n          to",["span",{"class":"token operator"},":"]," path",["span",{"class":"token punctuation"},"."],["span",{"class":"token function"},"resolve"],["span",{"class":"token punctuation"},"("],"__dirname",["span",{"class":"token punctuation"},","]," ",["span",{"class":"token string"},"'dist/assets'"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},","],"\n        ",["span",{"class":"token punctuation"},"}"],["span",{"class":"token punctuation"},","],"\n      ",["span",{"class":"token punctuation"},"]"],["span",{"class":"token punctuation"},","],"\n    ",["span",{"class":"token punctuation"},"}"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},","],"\n  ",["span",{"class":"token punctuation"},"]"],["span",{"class":"token punctuation"},","],"\n",["span",{"class":"token punctuation"},"}"],["span",{"class":"token punctuation"},";"]]],"\n  "],"\n  \n",["h3",{"id":"rollup-config-js"},"\n  ",["a",{"class":"heading-link","href":"#rollup-config-js"},["app-icon",{"name":"link"}],"\n  rollup.config.js\n  "],"\n"],"\n",["p",null,"A Rollup config will look something like the one below. Note how assets are copied from the library's ",["code",null,"node_module"]," folder to ",["code",null,"dist/assets"]," via the ",["code",null,"rollup-copy-plugin"]," utility. This is important if your library includes ",["a",{"href":"/docs/local-assets"},"local assets"],"."],"\n\n  ",["highlight-code",null,"\n    ",["pre",{"class":"language-javascript"},["code",{"class":"language-javascript"},["span",{"class":"token keyword"},"import"]," path ",["span",{"class":"token keyword"},"from"]," ",["span",{"class":"token string"},"'path'"],["span",{"class":"token punctuation"},";"],"\n",["span",{"class":"token keyword"},"import"]," commonjs ",["span",{"class":"token keyword"},"from"]," ",["span",{"class":"token string"},"'@rollup/plugin-commonjs'"],["span",{"class":"token punctuation"},";"],"\n",["span",{"class":"token keyword"},"import"]," copy ",["span",{"class":"token keyword"},"from"]," ",["span",{"class":"token string"},"'rollup-plugin-copy'"],["span",{"class":"token punctuation"},";"],"\n",["span",{"class":"token keyword"},"import"]," postcss ",["span",{"class":"token keyword"},"from"]," ",["span",{"class":"token string"},"'rollup-plugin-postcss'"],["span",{"class":"token punctuation"},";"],"\n",["span",{"class":"token keyword"},"import"]," resolve ",["span",{"class":"token keyword"},"from"]," ",["span",{"class":"token string"},"'@rollup/plugin-node-resolve'"],["span",{"class":"token punctuation"},";"],"\n\n",["span",{"class":"token keyword"},"export"]," ",["span",{"class":"token keyword"},"default"]," ",["span",{"class":"token punctuation"},"{"],"\n  input",["span",{"class":"token operator"},":"]," ",["span",{"class":"token string"},"'src/index.js'"],["span",{"class":"token punctuation"},","],"\n  output",["span",{"class":"token operator"},":"]," ",["span",{"class":"token punctuation"},"["],["span",{"class":"token punctuation"},"{"]," dir",["span",{"class":"token operator"},":"]," path",["span",{"class":"token punctuation"},"."],["span",{"class":"token function"},"resolve"],["span",{"class":"token punctuation"},"("],["span",{"class":"token string"},"'dist/'"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},","]," format",["span",{"class":"token operator"},":"]," ",["span",{"class":"token string"},"'es'"]," ",["span",{"class":"token punctuation"},"}"],["span",{"class":"token punctuation"},"]"],["span",{"class":"token punctuation"},","],"\n  plugins",["span",{"class":"token operator"},":"]," ",["span",{"class":"token punctuation"},"["],"\n    ",["span",{"class":"token function"},"resolve"],["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},","],"\n    ",["span",{"class":"token function"},"commonjs"],["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},","],"\n    ",["span",{"class":"token function"},"postcss"],["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},"{"],"\n      extensions",["span",{"class":"token operator"},":"]," ",["span",{"class":"token punctuation"},"["],["span",{"class":"token string"},"'.css'"],["span",{"class":"token punctuation"},"]"],["span",{"class":"token punctuation"},","],"\n    ",["span",{"class":"token punctuation"},"}"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},","],"\n    ",["span",{"class":"token function"},"copy"],["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},"{"],"\n      targets",["span",{"class":"token operator"},":"]," ",["span",{"class":"token punctuation"},"["],"\n        ",["span",{"class":"token punctuation"},"{"],"\n          src",["span",{"class":"token operator"},":"]," path",["span",{"class":"token punctuation"},"."],["span",{"class":"token function"},"resolve"],["span",{"class":"token punctuation"},"("],"__dirname",["span",{"class":"token punctuation"},","]," ",["span",{"class":"token string"},"'node_modules/my-library/dist/my-library/assets'"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},","],"\n          dest",["span",{"class":"token operator"},":"]," path",["span",{"class":"token punctuation"},"."],["span",{"class":"token function"},"resolve"],["span",{"class":"token punctuation"},"("],"__dirname",["span",{"class":"token punctuation"},","]," ",["span",{"class":"token string"},"'dist'"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},","],"\n        ",["span",{"class":"token punctuation"},"}"],["span",{"class":"token punctuation"},","],"\n      ",["span",{"class":"token punctuation"},"]"],["span",{"class":"token punctuation"},","],"\n    ",["span",{"class":"token punctuation"},"}"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},","],"\n  ",["span",{"class":"token punctuation"},"]"],["span",{"class":"token punctuation"},","],"\n",["span",{"class":"token punctuation"},"}"],["span",{"class":"token punctuation"},";"]]],"\n  "],"\n  \n",["h2",{"id":"how-is-this-different-from-the-dist-output-target"},"\n  ",["a",{"class":"heading-link","href":"#how-is-this-different-from-the-dist-output-target"},["app-icon",{"name":"link"}],"\n  How is this different from the \"dist\" output target?\n  "],"\n"],"\n",["p",null,"The ",["code",null,"dist-custom-elements-bundle"]," builds each component as a stand-alone class that extends ",["code",null,"HTMLElement"],". The output is a standardized custom element with the styles already attached and without any of Stencil's lazy-loading. This may be preferred for projects that are already handling bundling, lazy-loading and defining the custom elements themselves."],"\n",["p",null,"The ",["code",null,"dist"]," output target, on the other hand, is more for projects that want to allow components to lazy-load themselves, without having to setup bundling configurations to do so."],"\n",["p",null,"Luckily, both builds can be generated at the same time, using the same source code, and shipped in the same distribution. It would be up to the consumer of your component library to decide which build to use."],"\n\n",["h2",{"id":"browser-support"},"\n  ",["a",{"class":"heading-link","href":"#browser-support"},["app-icon",{"name":"link"}],"\n  Browser Support\n  "],"\n"],"\n",["p",null,"If the library is to be used on IE11 we recommend using the ",["a",{"href":"/docs/distribution"},["code",null,"dist"]," output target"]," instead since it will only load the required polyfills on-demand. The ",["code",null,"dist-custom-elements-bundle"]," is only recommended for modern browsers that already support Custom Elements, Shadow DOM, and CSS Variables (basically not IE11 or Edge 12-18). If this build is going to be used within legacy browsers then the project consuming these components will have to provide its own polyfills, and correctly downlevel the output to ES5."],"\n",["p",null,"Good news is that these are already widely supported for modern web develoment:"],"\n",["ul",null,"\n",["li",null,["a",{"href":"https://caniuse.com/#feat=custom-elementsv1"},"Custom Elements Support"]],"\n",["li",null,["a",{"href":"https://caniuse.com/#feat=shadowdomv1"},"Shadow DOM Support"]],"\n",["li",null,["a",{"href":"https://caniuse.com/#feat=css-variables"},"CSS Variables Support"]],"\n",["li",null,["a",{"href":"https://caniuse.com/#feat=es6-module"},"ES Modules"]],"\n",["li",null,["a",{"href":"https://caniuse.com/#feat=async-functions"},"async/await"]],"\n"]]}