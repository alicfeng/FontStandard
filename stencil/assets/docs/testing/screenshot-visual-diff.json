{"title":"Screenshot Visual Diff - Stencil","description":"Screenshot Visual Diff","url":"/docs/screenshot-visual-diff","contributors":["adamdbradley"],"headings":[{"id":"screenshot-visual-diff","level":1,"text":"Screenshot Visual Diff"},{"id":"visual-regression-testing-commands","level":2,"text":"Visual Regression Testing Commands"},{"id":"quick-example","level":2,"text":"Quick Example"},{"id":"advanced-example","level":2,"text":"Advanced Example"},{"id":"current-issues","level":2,"text":"Current issues:"}],"srcPath":"./src/docs/testing/screenshot-visual-diff.md","hypertext":["div",null,["h1",{"id":"screenshot-visual-diff"},"\n  \n  Screenshot Visual Diff\n  \n"],"\n",["p",null,["code",null,"EXPERIMENTAL"],": screenshot visual diff testing is currently under heavy development and has not reached a stable status. However, any assistance testing would be appreciated."],"\n\n",["h2",{"id":"visual-regression-testing-commands"},"\n  ",["a",{"class":"heading-link","href":"#visual-regression-testing-commands"},["app-icon",{"name":"link"}],"\n  Visual Regression Testing Commands\n  "],"\n"],"\n\n  ",["highlight-code",null,"\n    ",["pre",{"class":"language-bash"},["code",{"class":"language-bash"},"stencil ",["span",{"class":"token builtin class-name"},"test"]," --e2e --screenshot"]],"\n  "],"\n  \n",["h2",{"id":"quick-example"},"\n  ",["a",{"class":"heading-link","href":"#quick-example"},["app-icon",{"name":"link"}],"\n  Quick Example\n  "],"\n"],"\n",["p",null,["a",{"href":"https://github.com/GoogleChrome/puppeteer"},"Puppeteer"]," is used to compare screenshots. In order to make one, you have to set up an e2e test, e.g.:"],"\n\n  ",["highlight-code",null,"\n    ",["pre",{"class":"language-javascript"},["code",{"class":"language-javascript"},"  ",["span",{"class":"token function"},"it"],["span",{"class":"token punctuation"},"("],["span",{"class":"token string"},"'render something'"],["span",{"class":"token punctuation"},","]," ",["span",{"class":"token keyword"},"async"]," ",["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},")"]," ",["span",{"class":"token operator"},"=>"]," ",["span",{"class":"token punctuation"},"{"],"\n    ",["span",{"class":"token keyword"},"const"]," page",["span",{"class":"token operator"},":"]," E2EPage ",["span",{"class":"token operator"},"="]," ",["span",{"class":"token keyword"},"await"]," ",["span",{"class":"token function"},"newE2EPage"],["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"],"\n    ",["span",{"class":"token keyword"},"await"]," page",["span",{"class":"token punctuation"},"."],["span",{"class":"token function"},"setContent"],["span",{"class":"token punctuation"},"("],["span",{"class":"token string"},"'<my-cmp></my-cmp>'"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"],"\n    ",["span",{"class":"token keyword"},"await"]," page",["span",{"class":"token punctuation"},"."],["span",{"class":"token function"},"compareScreenshot"],["span",{"class":"token punctuation"},"("],["span",{"class":"token string"},"'My Component (...is beautiful. Look at it!)'"],["span",{"class":"token punctuation"},","]," ",["span",{"class":"token punctuation"},"{"],"fullPage",["span",{"class":"token operator"},":"]," ",["span",{"class":"token boolean"},"false"],["span",{"class":"token punctuation"},"}"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"],"\n  ",["span",{"class":"token punctuation"},"}"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"],"\n"]],"\n  "],"\n  \n",["h2",{"id":"advanced-example"},"\n  ",["a",{"class":"heading-link","href":"#advanced-example"},["app-icon",{"name":"link"}],"\n  Advanced Example\n  "],"\n"],"\n\n  ",["highlight-code",null,"\n    ",["pre",{"class":"language-javascript"},["code",{"class":"language-javascript"},["span",{"class":"token function"},"describe"],["span",{"class":"token punctuation"},"("],["span",{"class":"token string"},"'stencil-avatar'"],["span",{"class":"token punctuation"},","]," ",["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},")"]," ",["span",{"class":"token operator"},"=>"]," ",["span",{"class":"token punctuation"},"{"],"\n  ",["span",{"class":"token function"},"it"],["span",{"class":"token punctuation"},"("],["span",{"class":"token string"},"'renders and responds to the size property'"],["span",{"class":"token punctuation"},","]," ",["span",{"class":"token keyword"},"async"]," ",["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},")"]," ",["span",{"class":"token operator"},"=>"]," ",["span",{"class":"token punctuation"},"{"],"\n    ",["span",{"class":"token keyword"},"const"]," page ",["span",{"class":"token operator"},"="]," ",["span",{"class":"token keyword"},"await"]," ",["span",{"class":"token function"},"newE2EPage"],["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"],"\n\n    ",["span",{"class":"token comment"},"// In order to test against any global styles you may have, don't forget to set the link to the global css. You don't have to do this if your stencil.config.ts file doesn't build a global css file with globalStyle."],"\n    ",["span",{"class":"token keyword"},"await"]," page",["span",{"class":"token punctuation"},"."],["span",{"class":"token function"},"setContent"],["span",{"class":"token punctuation"},"("],["span",{"class":"token string"},"'<link href=\"http://localhost:3333/build/stellar-core.css\" rel=\"stylesheet\" /><stencil-avatar size=\"small\"></stencil-avatar>'"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"],"\n\n    ",["span",{"class":"token keyword"},"const"]," element ",["span",{"class":"token operator"},"="]," ",["span",{"class":"token keyword"},"await"]," page",["span",{"class":"token punctuation"},"."],["span",{"class":"token function"},"find"],["span",{"class":"token punctuation"},"("],["span",{"class":"token string"},"'stencil-avatar'"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"],"\n    ",["span",{"class":"token function"},"expect"],["span",{"class":"token punctuation"},"("],"element",["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},"."],["span",{"class":"token function"},"toHaveClass"],["span",{"class":"token punctuation"},"("],["span",{"class":"token string"},"'hydrated'"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"],"\n\n    ",["span",{"class":"token comment"},"// To start comparing the visual result, you first must run page.compareScreenshot; This will capture a screenshot, and save the file to \"/screenshot/images\". You'll be able to check that into your repo to provide those results to your team. You can only have one of these commands per test. "],"\n    ",["span",{"class":"token keyword"},"const"]," results ",["span",{"class":"token operator"},"="]," ",["span",{"class":"token keyword"},"await"]," page",["span",{"class":"token punctuation"},"."],["span",{"class":"token function"},"compareScreenshot"],["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"],"\n\n    ",["span",{"class":"token comment"},"// Finally, we can test against the previous screenshots. "],"\n    ",["span",{"class":"token comment"},"// Test against hard pixels"],"\n    ",["span",{"class":"token function"},"expect"],["span",{"class":"token punctuation"},"("],"results",["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},"."],["span",{"class":"token function"},"toMatchScreenshot"],["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},"{"]," allowableMismatchedPixels",["span",{"class":"token operator"},":"]," ",["span",{"class":"token number"},"100"]," ",["span",{"class":"token punctuation"},"}"],["span",{"class":"token punctuation"},")"],"\n\n    ",["span",{"class":"token comment"},"// Test against the percentage of changes. if 'allowableMismatchedRatio' is above 20% changed, "],"\n    ",["span",{"class":"token function"},"expect"],["span",{"class":"token punctuation"},"("],"results",["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},"."],["span",{"class":"token function"},"toMatchScreenshot"],["span",{"class":"token punctuation"},"("],["span",{"class":"token punctuation"},"{"]," allowableMismatchedRatio",["span",{"class":"token operator"},":"]," ",["span",{"class":"token number"},"0.2"]," ",["span",{"class":"token punctuation"},"}"],["span",{"class":"token punctuation"},")"],"\n\n  ",["span",{"class":"token punctuation"},"}"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"],"  \n",["span",{"class":"token punctuation"},"}"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"]]],"\n  "],"\n  ",["p",null,"After you've run your tests, you can open the ",["code",null,"/screenshot/compare.html"]," page in your project to see the changes and their differences. "],"\n\n",["h2",{"id":"current-issues"},"\n  ",["a",{"class":"heading-link","href":"#current-issues"},["app-icon",{"name":"link"}],"\n  Current issues:\n  "],"\n"],"\n",["ul",null,"\n",["li",null,"Only screenshot the inner width of the items in the body itself. Currently the screenshot is taken at 600x600 pixels, so it makes \"allowableMismatchedRatio\" not a very valuable option. Something like a ",["code",null,"await page.readjustSize()"]," that would clip the puppeteer page to the width of the rendered content would help make allowableMismatchedRatio more usable. "],"\n",["li",null,"Needs more testing! "],"\n"]]}